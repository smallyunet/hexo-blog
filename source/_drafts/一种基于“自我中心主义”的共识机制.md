---
title: 一种基于“自我中心主义”的共识机制
draft_date: 2021-10-26 16:02:51
tags:
- 区块链
- 共识
---

### 简介

“自我中心主义” 的含义是，对于每个人来说，世界的大小就是他能够接触到的世界的大小，世界很大，和我无关，世界很小，全和我有关。一个人认识的人、接触的事、接受到的信息，无论是否命中注定，一定是有限的，你不可能认识世界上所有的人，知道世界上所有的事。才学渊博、见多识广，又怎样呢。

在区块链中，共识机制是用来保证数据一致性的关键手段，也给区块链带来了最核心的去中心化的特点。共识机制是强一致性的，或者是在拥有一定容错能力的情况下，达到大多数一致的效果。有没有一种可能，存在一种共识机制，不以数据一致为首要目标呢？

世界本就是复杂的，试图将所有节点同步到仅仅一种数据状态，其实是违反直觉的。而且，无论是不需要授权的大范围共识，还是基于身份授权的小范围共识，最终实现数据一致的方法，都是 “多点变单点”，也就是同一时间只有一个节点在处理数据，其他节点可能是在共识后接受满足条件的数据，也可能在确认数据前投票是否同意对数据的操作，总之都是需要一个 “英雄” 一样的节点，在关键的变更数据的时刻，做一些事情。

有的英雄实力强大，先斩后奏，改过数据后过来跟你说，“我改了数据”，你一开始不满意，但是接触后发现英雄确实厉害，能做出你没有解决的难题，于是你就认可了英雄的行动。

还有的英雄被公众授予权力，行动之前作为代表被选举出来，行动的时候会万分小心，挨个问民众，“改动这里的数据，你同意吗？” 如果大多数人同意，英雄就会行动。

当然，每个人都有平等地享有做英雄的机会，虽然有的人天生神力，有的人八面玲珑，但机会总还是有的，题放在那里，你做不出来，怪谁？每个人就可以被选举，别人不选你，怪谁？

所以，为什么我们不能做自己的英雄？每个人都是自己的英雄。我们的世界，大小受限于个人能接触到范围，一种共识机制，范围受限于节点能触及的网络规模。

### 设想

#### 网络概况

在非结构化的点对点网络中，路由表是必不可少的组成部分，节点能够接触到的网络大小，就取决于路由表中存着多少 “联系方式”。共识对数据的处理，就以路由表中的节点为依据，路由表中有 10 个节点，就争取和这 10 个节点达成一致，路由表中有 10,000 个节点，就和 10,000 个节点达成一致。也没有必要使用分布式路由表，就普通的数组就可以。在这种情况下，网络中的节点会是这种样子：

<img src="21.png" width="50%">

以当前节点为中心，连接到的节点数量可多可少，有的很远，有的很近。弱水三千，只取一瓢。在路由发现的问题上，网络也是需要种子地址的，比如节点启动的时候先解析种子地址的记录：

```
lookup("seek.domain") 
    -> 127.0.0.1
    -> 127.0.0.2
```

然后依次请求解析出来的节点地址，去得到他们路由表中的内容，将其添加到自己的路由表中。这其实是常规做法，不过这样有可能引起的后果是，节点会瞬间获取到整个网络的路由信息。这并非不好，只是感觉有点快了，我们认识一个人是需要时间的，和人交谈也是需要时间的，你无法同时和三个人交谈，或者无法同时听三个人说话。即使拿到了很多人的联系方式，也没办法 “多线程” 联系每个人。总之我们处理信息的 “带宽” 有限，节点也一样。我们甚至可以对网络发现的速度稍微做一点限制，比如串行处理路由表新增记录的动作，先与节点建立连接然后再添加信息。

让路由发现慢一点，似乎听起来不太正常，难道是想让网络处于不同步的状态吗？网络可能会被划分为不同的区域，可能形成大大小小的圈子，可能是互联互通开放的，也可能存在保守封闭的。

<img src="22.png" width="50%">

对于共识算法来说，脑裂是要尽可能避免的问题，然而其实网络分割是再正常不过的、自然的情况。我们人类的思想是分裂的，有可能是对立的，但是经过一些事件后又可能达成一致。所以在一个网络中出现割裂是完全允许的情形，重点是要有一种机制能够 “修正” 这种分裂，也就是在某种条件下，割裂的两个网络可以相互合并。

### 同步数据

#### 主动

这里保留区块链创世块的概念，所有节点的第一个块内容是相同的。新加入网络的节点，会从创世块开始启动，此时其他节点的块高度已经有很多了。比如当前节点的块高度是 2，想要从网络中同步第 3 个块高度的内容，节点的路由表中有其他节点的地址，其他节点块高度均等于 3。当前节点会发起一个对块高度 3 的请求，依次到其他节点。

<img src="1.png" width="50%">

请求过后，发现有 2 个节点块高度为 3 的块一样，块的内容一样、块哈希一样、前块哈希也一样，那当前节点就把这个多数节点都存在的块作为第 3 个块。

<img src="2.png" width="50%">

如果请求的时候发现有的节点的块高度已经大于 3 了，那么是不是应该块高度最高的优先呢？如果考虑时间尺度的话，就会觉得事物发展是需要遵次序的，你不能跳过 3 岁直接过起 4 岁的人生，对于区块链的数据也应该按照次序。况且，当前节点需要的块高度是 3，请求的块高度是 3，管你有没有其他高度的块？

<img src="3.png" width="50%">

那么如果请求过所有节点，发现每个节点的块都不一样呢？该信谁？总得挑一个吧。如果不能确定哪个节点或者哪个内容可信的话，就随机选吧。最好是选择最后一个请求的节点，因为错过的节点就已经错过了，此时最后一个节点是距离你最近的节点，并且在此之前你并不能判断，是否存在块内容相同的节点。所以在放弃之前的节点后，最后一个节点就是你不可以放手的选择。

对于主动请求块数据的情况，很关键的地方是，请求一定是按照路由表顺序依次进行的，在得到第 1 个节点的响应之前，绝不向第 2 个节点发起请求，做人不能太三心二意了。如果有节点就刻意加速、同时请求多组数据呢？其实也无伤大雅，毕竟只是同步数据，有的人喜欢快点，有的人喜欢慢点，有的人喜欢快生活，有的人享受慢生活。

#### 被动

    被动
        优先原则

### 新增数据
    有节点接受
    没有节点接受
    只更新相同块高度
    同步的速度
    反内卷
        大部分低，一个高
        两个低，两个高
        一个低，大部分高

### 总结

这是一种没有经过实践考验的、也无法简单通过公式来建模的共识机制的设想，我们只能考虑节点基本的行为规则，就像我们学习生活规则一样，我们很难预测整个网络的走向，就像我们无法预测世界会向什么趋势发展。这种共识机制并不是而且也许不能解决特定的问题，比如建立电子现金系统或者提供图灵完备的运行平台，它关注在更基础一点的层面，提供一种实现数据一致性的方法和思路。

计算机通过网络组成的虚拟世界，一定也很精彩。
