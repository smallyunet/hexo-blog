<!DOCTYPE html><html lang="zh-cn"><head><title>PHP-GTK初体验：用最简单的方式运行环境，并实现Hello World</title><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=0.5"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="stylesheet" href="/css/highlight/xcode.min.css"><link rel="stylesheet" href="/css/bootstrap/bootstrap-tooltips.css"><link rel="stylesheet" href="/css/post.css"><script src="/js/jquery.min.js"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="smallyu的博客（疯狂版）" type="application/atom+xml">
</head><body><script>if (/mobile/i.test(navigator.userAgent) || /android/i.test(navigator.userAgent)) {
  document.body.classList.add('mobile')
  var navbar = document.querySelector('nav.navbar');
  if (navbar) {
    navbar.classList.remove('navbar-fixed-top');
  }
}
</script><div><div class="inner"><h1>PHP-GTK初体验：用最简单的方式运行环境，并实现Hello World</h1><div class="time">2017-02-22</div><ul class="tags"><li><span>#</span><a href="/tags/GTK/">GTK</a></li></ul><p>首先用最简单的方式把php-gtk运行起来，在gtk扩展官网（<a href="http://gtk.php.net/">http://gtk.php.net/</a> ）下载Binaries版本：</p>
<p>点击链接直接下载：<a href="http://gtk.php.net/distributions/PHP55-GTK2.zip">http://gtk.php.net/distributions/PHP55-GTK2.zip</a> （PHP-GTK-2.0.1 PHP 5.5）</p>
<p>官方文档提供了三种安装扩展的方式，  </p>
<ol>
<li><p>使用Gnope</p>
</li>
<li><p>手动安装</p>
</li>
<li><p>使用CVS编译</p>
</li>
</ol>
<p>事实上我们在下载.zip压缩包后解压到任意文件夹下，不需要任何配置或者编译行为。（如果只是先体验一下GTK实现的GUI窗口）</p>
<p><strong>一段简单的Hello World脚本</strong></p>
<p>在任意目录下新建一个文件，后缀名为.phpw，比如hello.phpw，编辑文件，写入以下代码：</p>
<pre><code class="php">&lt;?php
if (!class\_exists(&#39;gtk&#39;)) &#123;
    die(&quot;Please load the php-gtk2 module in your php.ini\\r\\n&quot;);
&#125;

$wnd = new GtkWindow();
$wnd-&gt;set\_title(&#39;Hello world&#39;);
$wnd-&gt;connect\_simple(&#39;destroy&#39;, array(&#39;gtk&#39;, &#39;main\_quit&#39;));

$lblHello = new GtkLabel(&quot;Just wanted to say\\r\\n&#39;Hello world!&#39;&quot;);
$wnd-&gt;add($lblHello);

$wnd-&gt;show\_all();
Gtk::main();
?&gt;
</code></pre>
<p>保存后，右击文件&gt;选择打开方式&gt;其它应用&gt;在这台电脑上浏览应用，选择我们下载并解压好的文件夹下的php-win.exe来执行文件，</p>
<img src="201702221487764340907853.png" alt="选择php-win.exe" />

<p>就可以得到这样的运行结果：  </p>
<img src="201702221487764357819986.png" alt="运行结果" />

<p><strong>检查PHP-GTK是否可用</strong></p>
<pre><code class="php">if (!class_exists(&#39;gtk&#39;)) &#123;
  die(&quot;Please load the php-gtk2 module in your php.ini\r\n&quot;);
&#125;
</code></pre>
<p>这里我们通过检查gtk类是否存在来确定PHP-GTK是否可用。不像PHP 4和PHP-GTK 1，你不应该通过d1()尝试加载PHP-GTK模块，因为这在PHP 5中是过时的，不应该用于新代码的编写。所以我们打印一个信息，如果模块不可用，就由用户来启用它。</p>
<p><strong>创建一个窗口</strong></p>
<pre><code class="php">$wnd = new GtkWindow();
</code></pre>
<p>创建一个窗口就像实例化一个新的对象一样简单：变量$wnd得到了新对象的引用。如果你已经使用PHP 4和PHP-GTK 1，你可以在关键词new之前不使用&amp;符号，因为在PHP 5中它会被自动创建。</p>
<p><strong>设置窗口标题</strong></p>
<pre><code class="php">$wnd-&gt;set_title(&#39;Hello world&#39;);
</code></pre>
<p>为了使窗口在任务栏中更容易被认出，我们设置了标题，仅仅调用了对象的一个方法。</p>
<p><strong>使关闭（操作）变得干净</strong></p>
<pre><code class="php">$wnd-&gt;connect_simple(&#39;destroy&#39;, array(&#39;gtk&#39;, &#39;main_quit&#39;));
</code></pre>
<p>这是代码中第一段稍有意思的部分：参数’destory’传递到了静态方法Gtk::main_quit中。它告诉GTK当窗口被关闭或者销毁的时候退出主循环。（后面会提到关于主循环的内容）</p>
<p><strong>创建一个展示文本的标签</strong>  </p>
<pre><code class="php">$lblHello = new GtkLabel(&quot;Just wanted to say\r\n&#39;Hello world!&#39;&quot;);
</code></pre>
<p>和上面一样，我们创建了一个新的部件。这次我们想要展示一小段文本，GtkLabel类可以完美的实现这个任务。</p>
<p><strong>添加标签到窗口</strong></p>
<pre><code class="php">$wnd-&gt;add($lblHello);
</code></pre>
<p>我们直接把标签添加到了窗口。  </p>
<p><strong>设置窗口为可见的</strong></p>
<pre><code class="php">$wnd-&gt;show_all();
</code></pre>
<p>到现在，我们在屏幕上看不见任何内容。为了使窗口可见，必须调用show()方法，它将会使窗口可见，但不是标签——我们在标签之上（也就是窗口对象上）调用show()。如果你有多个控件比如按钮、复选框或者其它窗口部件不方便一一调用，可以使用show_all()方法来显示所有可见的部件。</p>
<p><strong>开启主循环</strong></p>
<pre><code class="php">Gtk::main();
</code></pre>
<p>在设置完所有配置项之后，我们需要确定窗口停留在打开状态并且会对用户的行为进行反馈。一段普通的PHP脚本在文件执行结束后会停止，因此需要启动GTK主循环。它会保持应用处于运行状态并且会回应用户事件。如果事件发生，它会执行相应的回调。</p>
<p>（原内容：<a href="http://gtk.php.net/manual/en/html/tutorials/tutorials.helloworld.html">http://gtk.php.net/manual/en/html/tutorials/tutorials.helloworld.html</a> ）  </p>
<br>  

<p><strong>更加先进的Hello World脚本</strong></p>
<p>下面的参考内容会比上面的hello world脚本实现更多的功能。这里我们创建了一个登陆框，可以由用户来输入用户名和密码。当用户点击登陆，如果用户名或者密码为空，文本域可以检查错误并显示。</p>
<img src="201702221487764374675166.png" alt="高级Hello World" />

<p>首先我们先创建一个窗口，设置标题并设置当窗口销毁停止主循环（上面已经实现过）：  </p>
<pre><code class="php">$wnd = new GtkWindow();
$wnd-&gt;set_title(&#39;Login&#39;);
$wnd-&gt;connect_simple(&#39;destroy&#39;, array(&#39;gtk&#39;, &#39;main_quit&#39;));
</code></pre>
<p>接下来我们的任务是创建所有要显示的部件，先是两个文本域用户名和密码：</p>
<pre><code class="php">$txtUsername = new GtkEntry();
$txtPassword = new GtkEntry();
</code></pre>
<p>我们要分别给两个文本域一个描述的标签：</p>
<pre><code class="php">// 第二个参数意思是把下划线解析为下划线
$lblUsername = new GtkLabel(&#39;_Username&#39;, true);
$lblPassword = new GtkLabel(&#39;_Password&#39;, true);
</code></pre>
<p>最后我们需要两个按钮，登录和取消：  </p>
<pre><code class="php">$btnLogin  = new GtkButton(&#39;_Login&#39;);
$btnCancel = new GtkButton(&#39;_Cancel&#39;);
</code></pre>
<p>你可能注意到GtkLable类的构造函数中通过第二个参数设置解析下划线_为一个字符，但是GtkButton类中并没有，因为它会自动设置，这一点是需要记忆的。  </p>
<p>现在标签需要知道哪个行为被激活时使用哪个相应的内容，这样来做：</p>
<pre><code class="php">$lblUsername-&gt;set_mnemonic_widget($txtUsername);
$lblPassword-&gt;set_mnemonic_widget($txtPassword);
</code></pre>
<p>然后我们要决定哪个按钮被点击对应哪个事件。取消按钮会关闭窗口，结束程序，登录按钮会检查文本域是否为空等一系列操作：</p>
<pre><code class="php">$btnCancel-&gt;connect_simple(&#39;clicked&#39;, array($wnd, &#39;destroy&#39;));
$btnLogin -&gt;connect_simple(&#39;clicked&#39;, &#39;login&#39;, $wnd, $txtUsername, $txtPassword);
</code></pre>
<p>我们把三个参数$wnd、$txtUsername和$txtPassword传递给了登录函数，接下来的操作会用它们从文本域获取值，并且在所有工作结束后关闭窗口。</p>
<p>现在我们创建了我们需要的所有按钮，它们被添加到了窗口。GtkWindow库是功能容器，它可以捆绑为一个单独的部件，所以我们需要这个容器来更好的展示我们的其它元素。这里决定使用GtkTabel，它可以保持标签在一列，紧随其后的是确定域：  </p>
<pre><code class="php">$tbl = new GtkTable(3, 2);
$tbl-&gt;attach($lblCredit, 0, 2, 0, 1);
$tbl-&gt;attach($lblUsername, 0, 1, 1, 2);
$tbl-&gt;attach($txtUsername, 1, 2, 1, 2);
$tbl-&gt;attach($lblPassword, 0, 1, 2, 3);
$tbl-&gt;attach($txtPassword, 1, 2, 2, 3);
</code></pre>
<p>（$lblCredit仅仅是一个消息标签），按钮有它们自己的GtkHButtonBox类，因为这个允许它们更美观的布局多个按钮：</p>
<pre><code class="php">$bbox = new GtkHButtonBox();
$bbox-&gt;set_layout(Gtk::BUTTONBOX_EDGE);
$bbox-&gt;add($btnCancel);
$bbox-&gt;add($btnLogin);
</code></pre>
<p>对于布局最后要做的事情是把表格和按钮添加到窗口。没有直接的方法，因为GtkWindow是一个GtkBin（类库？），只能包含一个部件。所以我们需要另外的容器，这次用GtkVBox：  </p>
<pre><code class="php">$vbox = new GtkVBox();
$vbox-&gt;pack_start($tbl);
$vbox-&gt;pack_start($bbox);
</code></pre>
<p>它们所有都需要显示：</p>
<pre><code class="php">$wnd-&gt;add($vbox);
$wnd-&gt;show_all();
Gtk::main();
</code></pre>
<p>最后要做的事情，是当用户点击登陆按钮时候的回调事件。它需要检查用户名和密码是否为空，如果它们长度为0，则显示错误信息。如果一切ok，窗口将会关闭并且程序会继续运行来加载主窗口。  </p>
<p>从部件获取文本很简单，我们用GtkEntry的get_text()方法就能实现：</p>
<pre><code class="php">$strUsername = $txtUsername-&gt;get_text();
$strPassword = $txtPassword-&gt;get_text();
</code></pre>
<p>检查工作可以用平常的php函数。如果发生错误就显示一个带有错误消息的信息。GtkMessageDialog来完成这些工作是理想的，它可以自动创建图标和按钮（确认，是或否）：  </p>
<pre><code class="php">$dialog = new GtkMessageDialog($wnd, Gtk::DIALOG_MODAL, Gtk::MESSAGE_ERROR, Gtk::BUTTONS_OK, $errors);
$dialog-&gt;set_markup(&quot;The following errors occured:\r\n&lt;span foreground=&#39;red&#39;&gt;&quot; . $errors . &quot;&lt;/span&gt;&quot;);
$dialog-&gt;run();
$dialog-&gt;destroy();
</code></pre>
<p>现在可以确定你把登录功能函数放到了主循环中并使其运行。  </p>
<p><strong>完整代码</strong>  </p>
<pre><code class="php">&lt;?php
/**
*   Here we create a login window.
*   It has a username and a password field, and a
*   Cancel and Login button. Some error checking
*   is being done when the user clicks &quot;Login&quot;.
*/

if (!class\_exists(&#39;gtk&#39;)) &#123;
    die(&quot;Please load the php-gtk2 module in your php.ini\\r\\n&quot;);
&#125;

/**
*   This function gets called as soon as the user 
*   clicks on the Login button.
*
*   @param GtkWindow $wnd           The login window, needed to close it
*                                    when all is ok
*   @param GtkEntry $txtUsername    The username text field, used to get
*                                    the username
*   @param GtkEntry $txtPassword    The password widget to retrieve the
*                                    password
*/
function login(GtkWindow $wnd, GtkEntry $txtUsername, GtkEntry $txtPassword)
&#123;
    //fetch the values from the widgets into variables
    $strUsername = $txtUsername-&gt;get\_text();
    $strPassword = $txtPassword-&gt;get\_text();

    //Do some error checking
    $errors = null;
    if (strlen($strUsername) == 0) &#123;
        $errors .= &quot;Username is missing.\\r\\n&quot;;
    &#125;
    if (strlen($strPassword) == 0) &#123;
        $errors .= &quot;No password given.\\r\\n&quot;;
    &#125;

    if ($errors !== null) &#123;
        //There was at least one error.
        //We show a message box with the errors
        $dialog = new GtkMessageDialog($wnd, Gtk::DIALOG\_MODAL,
            Gtk::MESSAGE\_ERROR, Gtk::BUTTONS\_OK, $errors);
        $dialog-&gt;set\_markup(
            &quot;The following errors occured:\\r\\n&quot;
            . &quot;&lt;span foreground=&#39;red&#39;&gt;&quot; . $errors . &quot;&lt;/span&gt;&quot;
        );
        $dialog-&gt;run();
        $dialog-&gt;destroy();
    &#125; else &#123;
        //No error. You would need to hide the dialog now
        //instead of destroying it (because when you destroy it,
        //Gtk::main\_quit() gets called) and show the main window
        $wnd-&gt;destroy();
    &#125;
&#125;

//Create the login window
$wnd = new GtkWindow();
$wnd-&gt;set\_title(&#39;Login&#39;);
//Close the main loop when the window is destroyed
$wnd-&gt;connect\_simple(&#39;destroy&#39;, array(&#39;gtk&#39;, &#39;main\_quit&#39;));

//Set up all the widgets we need
$lblCredit   = new GtkLabel(&#39;Please provide your data&#39;);
//The second parameter says that the underscore should be parsed as underline
$lblUsername = new GtkLabel(&#39;\_Username&#39;, true);
$lblPassword = new GtkLabel(&#39;\_Password&#39;, true);
$txtUsername = new GtkEntry();
$txtPassword = new GtkEntry();
$btnLogin    = new GtkButton(&#39;\_Login&#39;);
$btnCancel   = new GtkButton(&#39;\_Cancel&#39;);

//Which widget should be activated when the 
// mnemonic (Alt+U or Alt+P) is pressed?
$lblUsername-&gt;set\_mnemonic\_widget($txtUsername);
$lblPassword-&gt;set\_mnemonic\_widget($txtPassword);
//Hide the password
//$txtPassword-&gt;set\_invisible\_char(&#39;*&#39;);

//Destroy the window when the user clicks Cancel
$btnCancel-&gt;connect\_simple(&#39;clicked&#39;, array($wnd, &#39;destroy&#39;));
//Call the login function when the user clicks on Login
$btnLogin-&gt;connect\_simple(&#39;clicked&#39;, &#39;login&#39;, $wnd, $txtUsername, $txtPassword);

//Lay out all the widgets in the table
$tbl = new GtkTable(3, 2);
$tbl-&gt;attach($lblCredit, 0, 2, 0, 1);
$tbl-&gt;attach($lblUsername, 0, 1, 1, 2);
$tbl-&gt;attach($txtUsername, 1, 2, 1, 2);
$tbl-&gt;attach($lblPassword, 0, 1, 2, 3);
$tbl-&gt;attach($txtPassword, 1, 2, 2, 3);

//Add the buttons to a button box
$bbox = new GtkHButtonBox();
$bbox-&gt;set\_layout(Gtk::BUTTONBOX\_EDGE);
$bbox-&gt;add($btnCancel);
$bbox-&gt;add($btnLogin);

//Add the table and the button box to a vbox
$vbox = new GtkVBox();
$vbox-&gt;pack\_start($tbl);
$vbox-&gt;pack\_start($bbox);

//Add the vbox to the window
$wnd-&gt;add($vbox);
//Show all widgets
$wnd-&gt;show\_all();
//Start the main loop
Gtk::main();
?&gt;
</code></pre>
<p>（原内容：<a href="http://gtk.php.net/manual/en/html/tutorials/tutorials.helloadvanced.html">http://gtk.php.net/manual/en/html/tutorials/tutorials.helloadvanced.html</a>）</p>
<p>The End.</p>
</div></div></body><script src="/js/highlight.min.js"></script><script src="/js/main.js"></script><script src="/js/bootstrap/bootstrap.min.js"></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-Y7C0CVX9PK"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-Y7C0CVX9PK');</script></html>